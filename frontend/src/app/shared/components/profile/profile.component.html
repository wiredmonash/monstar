<!-- Signed out state will show the sign up page -->
@if (state === 'signed out' || state === 'logged out') {
    <div class="signup-form">
        <!-- Signup form -->
        @if (state === 'signed out') {
            <!-- Sign Up Form -->
            <div class="left">
                <!-- Email input -->
                <div class="email-container">
                    <p-floatLabel>
                        <input id="email" 
                            pInputText 
                            class="{{inputEmailInvalid}}"
                            type="text" 
                            [(ngModel)]="inputEmail" 
                            (focus)="inputEmailInvalid = ''"
                            aria-labelledby="email-help"
                        />
                        <label for="email">Monash Email</label>
                    </p-floatLabel>
                    @if (inputEmailInvalid != '') {
                        <small id="email-help" style="background-color: rgb(248, 113, 113);">Email invalid (enter Monash email)</small>
                    } @else {
                        <small id="email-help">e.g. abcd0001&#64;student.monash.edu</small>
                    }
                </div>

                <!-- Password input-->
                <div class="password-container mt-1">
                    <p-floatLabel>
                        <p-password id="password" 
                            type="password" 
                            class="{{inputPasswordsInvalid}}"
                            [toggleMask]="true" 
                            [(ngModel)]="inputPassword"
                            (onFocus)="inputPasswordsInvalid = ''"
                        />
                        <label for="password">Password</label>
                    </p-floatLabel>
                </div>

                <!-- Confirm password input -->
                <div class="confirm-password-container mt-1">
                    <p-floatLabel>
                        <p-password id="confirm-password" 
                            type="password" 
                            class="{{inputPasswordsInvalid}}"
                            [toggleMask]="true" 
                            [disabled]="inputPassword == '' ? true : false" 
                            [feedback]="false" 
                            [(ngModel)]="inputPassword2"
                            (onFocus)="inputPasswordsInvalid = ''"
                            aria-labelledby="confirm-password-help"
                        />
                        <label for="confirm-password">Confirm Password</label>
                    </p-floatLabel>
                    @if (inputPasswordsInvalid != '') {
                        <small id="confirm-password-help" style="background-color: rgb(248, 113, 113);">Passwords do not match!</small>
                    } @else {
                        <small id="confirm-password-help">Retype your password to confirm.</small>
                    }
                </div>

                <!-- Sign Up Button -->
                <p-button 
                    label="Sign Up" 
                    icon="pi pi-user-plus" 
                    styleClass="w-10rem mx-auto"
                    [loading]="signingUp"
                    (click)="signup()"
                />

                <!-- Switch to login -->
                <p>Already have an account? 
                    <a 
                        pButton 
                        type="button" 
                        class="p-button-link" 
                        (click)="state='logged out'; titleChangeEvent.emit('Login');"
                    >
                        Login Here
                    </a>
                </p>
            </div>
        }

        <!-- Login form -->
        @else if (state === 'logged out') {
            <!-- Login Form -->
            <div class="left">
                <!-- Email input -->
                <div class="email-container">
                    <p-floatLabel>
                        <input id="email" 
                            pInputText 
                            class="{{inputEmailInvalid}}"
                            type="text" 
                            [(ngModel)]="inputEmail" 
                            (onFocus)="inputEmailInvalid = ''"
                            aria-labelledby="email-help"
                        />
                        <label for="email">Monash Email</label>
                    </p-floatLabel>
                    @if (inputEmailInvalid != '') {
                        <small id="email-help" style="background-color: rgb(248, 113, 113);">Email invalid (enter Monash email)</small>
                    }
                </div>

                <!-- Password input-->
                <div class="password-container mt-1">
                    <p-floatLabel>
                        <p-password id="password" 
                            type="password" 
                            class="{{inputPasswordsInvalid}}"
                            [toggleMask]="true" 
                            [feedback]="false"
                            [(ngModel)]="inputPassword"
                            (onFocus)="inputPasswordsInvalid = ''"
                        />
                        <label for="password">Password</label>
                    </p-floatLabel>
                </div>

                <!-- Login Submission -->
                <p-button 
                    label="Login" 
                    icon="pi pi-user" 
                    styleClass="w-10rem mx-auto" 
                    (click)="login()"
                    [loading]="loggingIn"
                />

                <!-- Transition to sign up form -->
                <p>Don't have an account? 
                    <a 
                        pButton 
                        type="button" 
                        class="p-button-link" 
                        (click)="state='signed out'; titleChangeEvent.emit('Sign Up');"
                    >
                        Sign Up
                    </a>
                </p>
            </div>
        }

        <!-- Divider -->
        <div class="middle">
            <p-divider layout="vertical">
                <b>OR</b>
            </p-divider>
        </div>

        <!-- "Sign in Monash Gmail" Button -->
        <div class="right">
            <button class="gsi-material-button">
                <div class="gsi-material-button-state"></div>
                <div class="gsi-material-button-content-wrapper">
                <div class="gsi-material-button-icon">
                    <svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 48 48" xmlns:xlink="http://www.w3.org/1999/xlink" style="display: block;">
                    <path fill="#EA4335" d="M24 9.5c3.54 0 6.71 1.22 9.21 3.6l6.85-6.85C35.9 2.38 30.47 0 24 0 14.62 0 6.51 5.38 2.56 13.22l7.98 6.19C12.43 13.72 17.74 9.5 24 9.5z"></path>
                    <path fill="#4285F4" d="M46.98 24.55c0-1.57-.15-3.09-.38-4.55H24v9.02h12.94c-.58 2.96-2.26 5.48-4.78 7.18l7.73 6c4.51-4.18 7.09-10.36 7.09-17.65z"></path>
                    <path fill="#FBBC05" d="M10.53 28.59c-.48-1.45-.76-2.99-.76-4.59s.27-3.14.76-4.59l-7.98-6.19C.92 16.46 0 20.12 0 24c0 3.88.92 7.54 2.56 10.78l7.97-6.19z"></path>
                    <path fill="#34A853" d="M24 48c6.48 0 11.93-2.13 15.89-5.81l-7.73-6c-2.15 1.45-4.92 2.3-8.16 2.3-6.26 0-11.57-4.22-13.47-9.91l-7.98 6.19C6.51 42.62 14.62 48 24 48z"></path>
                    <path fill="none" d="M0 0h48v48H0z"></path>
                    </svg>
                </div>
                <span class="gsi-material-button-contents">Sign in Monash Gmail</span>
                <span style="display: none;">Sign in Monash Gmail</span>
                </div>
            </button>
        </div>
    </div>
}

<!-- Confirmation after signing up -->
@else if (state === 'signed up') {
    <div class="confirmation">
        To be able to log in you must verify your email, check your inbox for the email you registered with. 
    </div>
}

<!-- Logged in state will show the profile -->
@else if (state === 'logged in') {
    <div class="profile">
        <p-menu #profileMenu [model]="profileMenuItems"></p-menu>
        <p-divider layout="vertical"></p-divider>

        <!-- Details-->
        @if (profileMenuState === 'details') {
            <div class="update-details">
                <h4>Your Details</h4>
                <p-card class="avatar-card m-0" [style]="{ overflow: 'hidden', }">
                    <p class="d-flex align-items-center p-0">
                        <!-- Profile picture -->
                        <img
                            src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcSWwfGUCDwrZZK12xVpCOqngxSpn0BDpq6ewQ&s" 
                            alt="Profile Picture"
                            class="mr-2 avatar"
                        />
                        <!-- Username -->
                        <span>{{ user?.username || 'No User' }}</span>
                    </p>
                </p-card>
                <p-floatLabel>
                    <input pInputText id="username" [(ngModel)]="inputUpdateUsername" />
                    <label for="username">Update your Username</label>
                </p-floatLabel>
                <p-floatLabel>
                    <input pInputText id="password" [(ngModel)]="inputUpdatePassword" />
                    <label for="password">New Password</label>
                </p-floatLabel>
                <p-button label="Update Details" styleClass="padding-top: 2rem;" (onClick)="updateDetails()"></p-button>
            </div>
        }
    </div>
}