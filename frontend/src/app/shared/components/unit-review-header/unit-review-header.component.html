<div class="unit-overview">
  <div class="row align-items-center ">
    <!-- Unit Info -->
    <div class="col-md-3 unit-title-container">
      <!-- Unit Code -->
      <h1 class="fw-bold unit-title">{{ unit.unitCode | uppercase }}</h1>
      <!-- Unit Name -->
      <p class="unit-subtitle">{{ unit.name }}</p>
    </div>

    <!-- Vertical Divider -->
    <div class="col-md-1 p-0">
      <div class="vr"></div>
    </div>

    <!-- Overall Rating -->
    <div class="col-md-2 overall-rating-container text-center">
      <h2 class="fw-bold overall-rating-title">{{ unit.avgOverallRating }} <span class="fs-5">out of 5</span></h2>
      <div class="stars">
        @for (star of [1,2,3,4,5]; track $index) {
          <i class="bi text-dark" 
              [class.bi-star-fill]="star <= unit.avgOverallRating"
              [class.bi-star]="star > unit.avgOverallRating"
          ></i>
        }
      </div>
      @if (unit.reviews.length > 1) {
        <p>{{ unit.reviews.length }} reviews</p>
      } 
      @else if (unit.reviews.length == 1) {
        <p>{{ unit.reviews.length }} review</p>
      }
      @else if (unit.reviews.length <= 0) {
        <p>No reviews</p>
      }
    </div>

    <!-- Ratings: Content, Relevancy, and Teaching Team -->
    <div class="col-md-4 d-flex p-0 ratings-section">
      <div class="d-flex flex-column me-3">
        <!-- Content Section -->
        <div class="text-left smaller-section content-rating">
          <div class="label-with-rating">
            <p>Content</p>
            <p class="rating-number">{{ unit.avgContentRating }}</p>
          </div>
          <div class="stars smaller-stars">
            @for (star of [1,2,3,4,5]; track $index) {
              <i class="bi text-dark" 
                  [class.bi-star-fill]="star <= unit.avgContentRating"
                  [class.bi-star]="star > unit.avgContentRating"
              ></i>
            }
          </div>
        </div>

        <!-- Teaching Team Section -->
        <div class="text-left smaller-section teaching-team-rating mt-2">
          <div class="label-with-rating">
            <p>Teaching Team</p>
            <p class="rating-number">{{ unit.avgFacultyRating }}</p>
          </div>
          <div class="stars smaller-stars">
            @for (star of [1,2,3,4,5]; track $index) {
              <i class="bi text-dark" 
                  [class.bi-star-fill]="star <= unit.avgFacultyRating"
                  [class.bi-star]="star > unit.avgFacultyRating"
              ></i>
            }
          </div>
        </div>
      </div>

      <!-- Relevancy Section -->
      <div class="text-left smaller-section relevancy-rating">
        <div class="label-with-rating">
          <p>Relevancy</p>
          <p class="rating-number">{{ unit.avgRelevancyRating }}</p>
        </div>
        <div class="stars smaller-stars">
          @for (star of [1,2,3,4,5]; track $index) {
            <i class="bi text-dark" 
                [class.bi-star-fill]="star <= unit.avgRelevancyRating"
                [class.bi-star]="star > unit.avgRelevancyRating"
            ></i>
          }
        </div>
      </div>
    </div>
  </div>

  <!-- Sort By and Filter Section -->
  <div class="row d-flex justify-content-end buttons-container">
    <!-- Write a Review Button -->
    <div class="col-auto">
      <button class="btn btn-outline-white filter-btn" (click)="showDialog()">
        <i class="bi bi-pencil"></i> Write a review
      </button>
    </div>

    <!-- Sort By Dropdown -->
    <div class="col-auto">
      <div class="dropdown">
        <button class="btn btn-outline-dark sort-by-btn dropdown-toggle mb-3" type="button" id="sortDropdown" data-bs-toggle="dropdown" aria-expanded="false">
          Sort by
        </button>
        <ul class="dropdown-menu" aria-labelledby="sortDropdown">
          <!-- The different criteria for sorting the reviews (event handler called on click) -->
          <li><button class="dropdown-item" (click)="onSort('recent')">Recent</button></li> 
          <li><button class="dropdown-item" (click)="onSort('lowest-rating')">Lowest Rating</button></li> 
          <li><button class="dropdown-item" (click)="onSort('highest-rating')">Highest Rating</button></li> 
        </ul>
      </div>
    </div>

    <!-- Filter Button -->
    <div class="col-auto">
      <button class="btn btn-outline-dark filter-btn">
        <i class="bi bi-sliders"></i> Filter
      </button>
    </div>
  </div>
</div>

<!-- ! TESTING THE POPUP REVIEW (For Ricky to work with) -->
<!-- This should be a separate component. -->
<!-- This is shown when the visible variable is set to true -->
<!-- Some styling changes need to be made... -->
<!-- Some of the fields are too large and there is too much padding, use scss to fix this. -->
<!-- Also change the stuff to be more relevant for writing a review instead of profile :-) -->
<p-dialog header="Edit Profile" [modal]="true" [(visible)]="visible" [style]="{ width: '25rem' }">
  <span class="p-text-secondary block mb-5">Update your information.</span>
  <div class="flex align-items-center gap-3 mb-3">
      <label for="username" class="font-semibold w-6rem">Username</label>
      <input pInputText id="username" class="flex-auto" autocomplete="off" />
  </div>
  <div class="flex align-items-center gap-3 mb-5">
      <label for="email" class="font-semibold w-6rem">Email</label>
      <input pInputText id="email" class="flex-auto" autocomplete="off" />
  </div>
  <div class="flex justify-content-end gap-2">
      <p-button label="Cancel" severity="secondary" (onClick)="visible = false" />
      <p-button label="Save" (onClick)="visible = false" />
  </div>
</p-dialog>
