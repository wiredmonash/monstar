@if (loading) {
  <!-- Loading skeleton -->
  <p-skeleton
    height="4rem"
    borderRadius="16px"
  />
} @else {
  <p-accordion [activeIndex]="accordionExpanded ? 0 : null">
    <p-accordionTab
      [pTooltip]="headerTooltip"
      tooltipPosition="bottom"
      [disabled]="!!error || !selectedSetu || isDesktopView"
    >
      <ng-template pTemplate="header">
        <div class="setu-header">
          <h2 class="setu-title">
            @if (error || !selectedSetu) {
              No SETU Data Available
            } @else {
              SETU Overview
            }
          </h2>
        </div>
      </ng-template>

      <!-- Error State -->
      <div *ngIf="error" class="setu-content-centered">
        <small class="p-error">{{ error }}</small>
      </div>

      <!-- No Data State -->
      <div *ngIf="!error && !selectedSetu" class="setu-content-centered">
        <small>No SETU data available for this unit.</small>
      </div>

      <!-- Content Display -->
      <ng-container *ngIf="!error && selectedSetu">
        <!-- Controls -->
        <div class="setu-controls">
          <!-- Choose SETU season -->
          <p-splitButton [label]="getSeasonDisplay(selectedSetu.Season)" icon="pi pi-calendar" [model]="semesterMenuItems"
            styleClass="semester-btn" [disabled]="semesterMenuItems.length === 0">
          </p-splitButton>

          <!-- Quantities -->
          <div class="setu-footer">
            Responses: {{selectedSetu.Responses}} / {{selectedSetu.Invited}} ({{getResponseRatePercent(selectedSetu)}}%)
          </div>
        </div>

        <!-- Setu cards row -->
        <div class="setu-cards">
          <!-- Aggregate score -->
          <div class="card">
            <h3>Aggregate Score</h3>
            <div class="value-progress">
              <div class="value">{{ selectedSetu.getAggregateScore().toFixed(1) }}</div>
              <div class="bar">
                <p-progressBar [value]="getScoreAsPercentage(selectedSetu.getAggregateScore())"
                  [showValue]="false"></p-progressBar>
              </div>
            </div>
          </div>
          <!-- University wide average -->
          <div class="card">
            <h3>University Wide Average</h3>
            <div class="value-progress">
              <div class="value">{{ selectedSetu.getUniversityWideAverage().toFixed(1) }}</div>
              <div class="bar">
                <p-progressBar [value]="getScoreAsPercentage(selectedSetu.getUniversityWideAverage())"
                  [showValue]="false"></p-progressBar>
              </div>
            </div>
          </div>
          <!-- Faculty wide average -->
          <div class="card">
            <h3>Faculty Wide Average</h3>
            <div class="value-progress">
              <div class="value">{{ selectedSetu.getFacultyWideAverage().toFixed(1) }}</div>
              <div class="bar">
                <p-progressBar [value]="getScoreAsPercentage(selectedSetu.getFacultyWideAverage())"
                  [showValue]="false"></p-progressBar>
              </div>
            </div>
          </div>
        </div>

        <!-- Redirect to full SETU report button -->
        <div class="button-container">
          <p-button 
            icon="pi pi-eye" 
            label="See full SETU Results" 
            rounded="true" 
            (onClick)="goToSetuOverview($event)"
          ></p-button>
        </div>
      </ng-container>

    </p-accordionTab>
  </p-accordion>
}